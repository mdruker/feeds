<!DOCTYPE html>
<html>
<head>
    <title>feeds.mdruker.app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
<div class="container">
    <!-- Login View -->
    <div id="login-view" style="display: none">
        <div class="card">
            <h1>feeds.mdruker.app - Bluesky feed settings</h1>
            <p>You need to log in with bsky.social to access your settings.</p>
            <form id="login-form">
                <input
                  id="login-handle"
                  type="text"
                  name="handle"
                  placeholder="Enter your handle (eg alice.bsky.social)"
                  required
                />
                <button type="submit" class="primary-button">Log in</button>
                <p id="login-error" class="error"></p>
            </form>
        </div>
    </div>

    <!-- Settings View -->
    <div id="settings-view" style="display: none">
        <!-- Header -->
        <div class="card">
            <div class="header-content">
                <div>
                    <h1>feeds.mdruker.app - Bluesky feed settings</h1>
                    <p class="user-info">Logged in as <span id="user-handle"></span></p>
                </div>
                <form id="logout-form">
                    <button type="submit" class="secondary-button">Log out</button>
                </form>
            </div>
        </div>

        <!-- Feed Settings -->
        <div class="card">
            <h2>Feed Settings</h2>
            <form id="settings-form">
                <div class="compact-settings">
                    <div class="compact-setting-group">
                        <h3>Replies</h3>
                        <p class="setting-description">Show only initial posts, or include replies as well</p>
                        <div class="compact-options">
                            <label class="compact-radio">
                                <input type="radio" id="include_replies_false" name="include_replies" value="false">
                                <span class="radio-label">No replies</span>
                            </label>
                            <label class="compact-radio">
                                <input type="radio" id="include_replies_true" name="include_replies" value="true">
                                <span class="radio-label">Include replies</span>
                            </label>
                        </div>
                    </div>

                    <div class="compact-setting-group">
                        <h3>Reposts</h3>
                        <p class="setting-description">The feed can include some reposts. Currently, these are the ones most reposted by your follows, but you should only see them once.</p>
                        <div class="compact-input-row">
                            <input type="number" id="repost_percent" name="repost_percent" min="0" max="50">
                            <span class="input-suffix">% of posts can be reposts</span>
                        </div>
                    </div>

                    <div class="compact-setting-group">
                        <h3>Recent Posts <span class="experimental-label">Experimental</span></h3>
                        <p class="setting-description">Before switching to the most engaged posts, the feed can show you an unfiltered view of a few of the latest posts.</p>
                        <div class="compact-input-row">
                            <input type="number" id="num_recent_posts" name="num_recent_posts" min="0" max="1000">
                            <span class="input-suffix">newest posts shown first</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="primary-button">Save Settings</button>
            </form>
        </div>

        <div class="card">
            <h2>Posts Per Account</h2>
            <p class="setting-description">The Catch Up feed shows the most engaged posts per account. How many per account is based on a default combined with a possible override. E.g. a default of 3 will show you at most 3 posts per account, and if you add an override for a specific account you follow of -2, it'll only show you at most 1 from that account.</p>

            <div class="default-setting">
                <div class="setting-row">
                    <input type="number" id="posts_per_account" name="posts_per_account" min="0" max="100">
                    <label for="posts_per_account">
                        <span class="description">Number of most engaged posts to show per account per 24 hours by default</span>
                    </label>
                    <button type="button" id="save-default" class="secondary-button">Save Default</button>
                </div>
            </div>
            
            <div id="existing-scores" style="margin-top: 24px;">
                <h3>Account-Specific Overrides</h3>
                <p class="setting-description">Override the default for specific accounts. Positive values add to the default, negative values subtract from it.</p>
                <div id="scores-list" class="scores-list">
                    <!-- Scores will be loaded here -->
                </div>
            </div>

            <div class="add-score-section">
                <h3>Add New Override</h3>
                <form id="add-score-form">
                    <div class="form-row">
                        <input type="text" id="score-handle" name="handle" placeholder="Enter handle (e.g., alice.bsky.social)" required>
                        <input type="number" id="score-value" name="score" min="-10" max="10" step="1" placeholder="Score (e.g. -2 or 5)" required>
                        <button type="submit" class="primary-button">Add Override</button>
                    </div>
                    <div id="profile-preview" class="profile-preview" style="display: none;">
                        <img id="profile-avatar" class="profile-avatar" src="" alt="">
                        <div class="profile-info">
                            <div class="profile-name" id="profile-name"></div>
                            <div class="profile-handle" id="profile-handle-display"></div>
                            <div class="profile-status" id="current-score"></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast" role="alert" aria-live="polite"></div>

<script src="/app.js"></script>
</body>
</html>